<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Selex Mall â€” Admin</title>
<style>
  :root{
    --bg: #ffffff;
    --page-bg: #f3f4f6;
    --text: #0f172a;
    --muted: #6b7280;
    --accent: #111827;
    --accent2: #374151;
    --danger: #dc2626;
    --card-radius: 12px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  body {
    margin: 0;
    padding: 0;
    background: var(--page-bg);
    color: var(--text);
  }

  .site {
    width: 100%;
    padding: 20px 40px 80px;
    box-sizing: border-box;
  }
  /* NAV */
  .nav {
    display:flex;
    align-items:center;
    justify-content:space-between;
    background:var(--bg);
    padding:18px 22px;
    border-radius:14px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.06);
    margin-bottom:22px;
  }
  .logo {
    width:45px;height:45px;
    background:linear-gradient(135deg,#111827,#374151);
    border-radius:10px;
    display:flex;align-items:center;justify-content:center;
    color:white;font-weight:700;font-size:18px;
  }
   .brand-text h1 {
    margin:0;font-size:20px;color:var(--accent);
  }
  .brand-text p {
    margin:0;font-size:12px;color:var(--muted);
  }
  .nav-links button {
    background:transparent;
    border:none;
    padding:10px 16px;
    border-radius:8px;
    cursor:pointer;
    font-size:15px;
    color:var(--accent2);
    font-weight:600;
  }
  .nav-links button.active {
    background:var(--accent);
    color:white;
    box-shadow:0 4px 14px rgba(0,0,0,0.1);
  }
   /* CARDS */
  .card {
    background:var(--bg);
    padding:20px;
    border-radius:var(--card-radius);
    margin-bottom:24px;
    box-shadow:0 6px 22px rgba(0,0,0,0.05);
  }
  h2 {
    margin:0 0 18px;
    font-size:19px;
    color:var(--accent);
  }
  
  /* FORMS */
  .form-row {
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    margin-bottom:12px;
  }
  input, select {
    padding:10px 12px;
    border-radius:8px;
    border:1px solid #e5e7eb;
    font-size:14px;
    min-width:150px;
  }
  .btn {
    background:var(--accent);
    color:white;
    padding:10px 14px;
    border:none;
    border-radius:8px;
    font-weight:600;
    cursor:pointer;
  }
  .btn.ghost {
    background:transparent;
    color:var(--accent2);
    border:1px solid rgba(17,24,39,0.12);
  }
  .btn.small {
    padding:6px 10px;
    font-size:13px;
    border-radius:6px;
  }
  .btn.danger {
    background:var(--danger);
    color:white;
  }
  /* TABLES */
  table {
    width:100%;
    border-collapse:collapse;
    margin-top:14px;
    font-size:14px;
  }
  th, td {
    padding:12px 10px;
    border-bottom:1px solid #e5e7eb;
  }
  th {
    color:var(--muted);
    font-size:13px;
    font-weight:700;
  }
  .empty {
    padding:18px 8px;
    color:var(--muted);
  }
  /* MODAL */
  .modal-backdrop {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.45);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:200;
  }
  .modal {
    background:white;
    padding:20px;
    width:95%;
    max-width:420px;
    border-radius:12px;
    box-shadow:0 10px 40px rgba(0,0,0,0.25);
  }
  .modal h3 { margin-top:0; }
   /* Responsive */
  @media(max-width:700px){
    .site { padding:20px; }
    input, select { width:100%; }
  }
</style>
</head>

<body>
<div class="site">
  <!-- NAVBAR -->
  <div class="nav">
    <div style="display:flex;align-items:center;gap:14px;">
      <div class="logo">SM</div>
      <div class="brand-text">
        <h1>Selex Mall</h1>
        <p>Admin panel</p>
      </div>
    </div>

    <div class="nav-links">
      <button id="tab-shops" class="active">Shops</button>
      <button id="tab-emps">Employees</button>
    </div>
  </div>
  <!-- SHOPS VIEW -->
  <div id="shops-view">
    <div class="card">
      <h2>Create Shop</h2>
      <div class="form-row">
        <input id="shop-name" placeholder="Shop name">
        <input id="shop-category" placeholder="Category">
        <input id="shop-location" placeholder="Location">
        <input id="shop-phone" placeholder="Phone">
        <button id="btn-create-shop" class="btn">Add</button>
      </div>

      <div class="form-row">
        <input id="search-shops" placeholder="Search shops...">
        <button id="btn-search-shops" class="btn ghost small">Search</button>
        <button id="btn-refresh-shops" class="btn ghost small">Refresh</button>
      </div>

      <table id="shops-table"></table>
      <div id="shops-empty" class="empty" style="display:none;">No shops yet.</div>
    </div>
  </div>
  <!-- EMPLOYEES VIEW -->
  <div id="emps-view" style="display:none;">
    <div class="card">
      <h2>Create Employee</h2>
      <div class="form-row">
        <input id="emp-first" placeholder="First name">
        <input id="emp-last" placeholder="Last name">
        <input id="emp-role" placeholder="Role">
        <select id="emp-shop-select"><option value="">Assign to shop</option></select>
        <input id="emp-email" placeholder="Email (optional)">
        <button id="btn-create-emp" class="btn">Add</button>
      </div>

      <table id="emps-table"></table>
      <div id="emps-empty" class="empty" style="display:none;">No employees yet.</div>
    </div>
  </div>

</div>
<!-- EDIT MODAL -->
<div id="modal" class="modal-backdrop">
  <div class="modal">
    <h3 id="modal-title"></h3>
    <div id="modal-body"></div>
    <div style="margin-top:14px;display:flex;justify-content:flex-end;gap:8px;">
      <button id="modal-cancel" class="btn ghost small">Cancel</button>
      <button id="modal-save" class="btn small">Save</button>
    </div>
  </div>
</div>

<script>
async function api(path, opts={}) {
  const res = await fetch('/api' + path, opts);
  if (!res.ok && res.status !== 204) {
    const txt = await res.text();
    throw new Error(txt);
  }
  return res.status === 204 ? null : res.json();
}

/* TAB HANDLING */
const shopsView = document.getElementById('shops-view');
const empsView = document.getElementById('emps-view');
document.getElementById('tab-shops').onclick = () => { shopsView.style.display='block'; empsView.style.display='none'; tabActive('shops'); };
document.getElementById('tab-emps').onclick = () => { shopsView.style.display='none'; empsView.style.display='block'; tabActive('emps'); };
function tabActive(x){
  document.getElementById('tab-shops').classList.toggle('active', x==='shops');
  document.getElementById('tab-emps').classList.toggle('active', x==='emps');
}

/* SHOPS */
async function fetchShops(q=''){
  const shops = await api('/shops' + (q?'?q='+encodeURIComponent(q):''));
  const table = document.getElementById('shops-table');
  table.innerHTML = '';
  if(!shops.length){
    document.getElementById('shops-empty').style.display='block';
    return;
  }
  document.getElementById('shops-empty').style.display='none';
  table.innerHTML = `
    <thead><tr>
      <th>Name</th><th>Category</th><th>Location</th><th>Phone</th><th>Actions</th>
    </tr></thead><tbody></tbody>`;
  const tbody = table.querySelector('tbody');
  shops.forEach(s=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `
      <td>${s.name}</td>
      <td>${s.category}</td>
      <td>${s.location}</td>
      <td>${s.phone}</td>
      <td>
        <button class="btn small" onclick="editShop('${s.id}')">Edit</button>
        <button class="btn small danger" onclick="deleteShop('${s.id}')">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
  fillShopSelect(shops);
}

document.getElementById('btn-create-shop').onclick = async ()=>{
  const payload = {
    name:document.getElementById('shop-name').value,
    category:document.getElementById('shop-category').value,
    location:document.getElementById('shop-location').value,
    phone:document.getElementById('shop-phone').value
  };
  await api('/shops',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
  fetchShops();
};

document.getElementById('btn-search-shops').onclick=()=>fetchShops(document.getElementById('search-shops').value);
document.getElementById('btn-refresh-shops').onclick=()=>{document.getElementById('search-shops').value='';fetchShops();};

/* EMPLOYEES */
async function fetchEmployees(){
  const emps = await api('/employees');
  const shops = await api('/shops');
  const table = document.getElementById('emps-table');
  table.innerHTML = '';
  if(!emps.length){
    document.getElementById('emps-empty').style.display='block';
    return;
  }
  document.getElementById('emps-empty').style.display='none';
  const map = Object.fromEntries(shops.map(s=>[s.id,s.name]));
  table.innerHTML = `
    <thead><tr>
      <th>Name</th><th>Role</th><th>Shop</th><th>Email</th><th>Actions</th>
    </tr></thead><tbody></tbody>`;
  const tbody = table.querySelector('tbody');
  emps.forEach(e=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `
      <td>${e.firstName} ${e.lastName}</td>
      <td>${e.role}</td>
      <td>${map[e.shopId]||''}</td>
      <td>${e.email||''}</td>
      <td>
        <button class="btn small" onclick="editEmp('${e.id}')">Edit</button>
        <button class="btn small danger" onclick="deleteEmp('${e.id}')">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

document.getElementById('btn-create-emp').onclick = async ()=>{
  const payload = {
    firstName:document.getElementById('emp-first').value,
    lastName:document.getElementById('emp-last').value,
    role:document.getElementById('emp-role').value,
    shopId:document.getElementById('emp-shop-select').value,
    email:document.getElementById('emp-email').value
  };
  await api('/employees',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
  fetchEmployees();
};

/* Select fill */
function fillShopSelect(shops){
  const sel=document.getElementById('emp-shop-select');
  sel.innerHTML='<option value="">Assign to shop</option>';
  shops.forEach(s=>{
    const o=document.createElement('option');o.value=s.id;o.text=s.name;sel.appendChild(o);
  });
}







